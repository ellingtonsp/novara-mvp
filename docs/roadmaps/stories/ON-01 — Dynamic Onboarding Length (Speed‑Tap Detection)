# ON-01 — Onboarding A/B Experiment (Fast Lane vs. Control)

## 📊 Story Overview

**Epic**: E2 Insight Polish  
**Story Points**: 3  
**Status**: ✅ COMPLETE  
**Priority**: High  

## 🎯 User Story

**As a** new Novara user  
**I want** to have an optimized onboarding experience  
**So that** I can start receiving personalized insights with minimal friction  

## 🔬 A/B Test Design

### Control Path (50%)
- **Full 6-question onboarding** as currently implemented
- Email, nickname, confidence scores (3), cycle stage, primary concern
- Track completion rates and time-to-first-insight

### Test Path (50%) 
- **Fast Lane: 3-question onboarding** (email, cycle stage, primary concern)
- **BaselinePanel**: Remaining questions appear after first check-in, before first insight
- Track completion rates, baseline completion rates, retention

## ✅ Acceptance Criteria

### Core Functionality
- [x] **Path Selection**: Users randomly assigned to control/test (50/50 split)
- [x] **Fast Onboarding**: 3-field form for test path users  
- [x] **BaselinePanel**: Modal appears after first check-in for test users
- [x] **Analytics Events**: `onboarding_path_selected`, `onboarding_completed`, `baseline_completed`
- [x] **Data Consistency**: All users have complete profiles regardless of path

### Technical Requirements
- [x] **PostHog Integration**: Feature flag `fast_onboarding_v1` for production control
- [x] **Database Schema**: Add `baseline_completed`, `onboarding_path` fields
- [x] **API Endpoints**: `/api/users/baseline` for updating baseline data
- [x] **Development Testing**: Force path selection via environment variables

### Success Metrics
- **Primary**: Onboarding completion rate (target: +15% for test path)
- **Secondary**: Time to first insight (target: <2 minutes for test path)
- **Retention**: 7-day active user rate comparison between paths

## 🛠️ Technical Implementation

### Frontend Components
- `OnboardingFast.tsx` - 3-field fast onboarding form
- `BaselinePanel.tsx` - Progressive multi-step question collection  
- `abTestUtils.ts` - A/B test logic and analytics tracking
- `NovaraLanding.tsx` - Path selection and modal integration

### Backend Changes
- SQLite schema: Add `baseline_completed`, `onboarding_path` fields
- API endpoint: `PATCH /api/users/baseline` for baseline data updates
- User model: Include A/B test fields in authentication context

### Analytics Events

```typescript
// Path selection (immediate)
onboarding_path_selected: {
  path: 'control' | 'test',
  session_id: string,
  timestamp: number
}

// Onboarding completion
onboarding_completed: {
  path: 'control' | 'test', 
  completion_ms: number,
  user_id: string,
  session_id: string
}

// Baseline completion (test path only)
baseline_completed: {
  completion_ms: number,
  user_id: string,
  session_id: string
}
```

## 🎮 User Journey

### Control Path Journey
1. Click "Start Your Journey"
2. Complete 6-question onboarding form
3. Create account → Welcome insight
4. Daily check-ins → Insights

### Test Path Journey  
1. Click "Start Your Journey"
2. Complete 3-question Fast Lane onboarding
3. Create account → Welcome insight
4. Daily check-ins → **BaselinePanel appears**
5. Complete baseline questions → Insights

## 🧪 Testing Strategy

### Development Testing
```bash
# Force control path
VITE_FORCE_ONBOARDING_PATH=control

# Force test path  
VITE_FORCE_ONBOARDING_PATH=test

# Enable debug logging
VITE_DEBUG_AB_TEST=true
```

### Production Rollout
1. **Phase 1**: 10% test / 90% control via PostHog feature flag
2. **Phase 2**: 50% test / 50% control if metrics positive
3. **Phase 3**: 100% test if successful, or rollback to control

## 📈 Success Criteria

### Completion Rates
- **Control baseline**: Current onboarding completion rate
- **Test target**: +15% improvement in onboarding completion
- **Baseline target**: >80% of test users complete BaselinePanel

### Time Metrics
- **Control**: Current average time to complete onboarding
- **Test target**: <2 minutes for Fast Lane onboarding
- **BaselinePanel**: <3 minutes average completion time

### Retention Impact
- **7-day retention**: Test path ≥ control path retention
- **Insight engagement**: Test users ≥ control users in first week

## 🔒 Data & Privacy

- No additional PII collection
- Same data ultimately collected for all users
- A/B test assignment not stored with PII
- Analytics events follow existing privacy policies

## 🚀 Deployment Notes

### Environment Variables Required
```bash
# Frontend
VITE_AB_TEST_ENABLED=true
VITE_FORCE_ONBOARDING_PATH=  # Leave empty for random
VITE_DEBUG_AB_TEST=false    # Set to true for development

# PostHog Feature Flag
fast_onboarding_v1 = true/false (50% rollout)
```

### Database Migration
```sql
-- SQLite schema update (automatic via adapter)
ALTER TABLE users ADD COLUMN baseline_completed BOOLEAN DEFAULT 0;
ALTER TABLE users ADD COLUMN onboarding_path TEXT;
```

## ✅ Definition of Done

- [x] A/B test infrastructure implemented and tested
- [x] Both onboarding paths functional and validated  
- [x] BaselinePanel integration working correctly
- [x] Analytics events firing and tracked properly
- [x] Development testing capabilities functional
- [x] PostHog feature flag integration ready
- [x] Documentation complete and UAT script created
- [x] Code committed and ready for staging deployment

---

**✅ IMPLEMENTATION COMPLETE**  
**Ready for UAT and staging deployment**