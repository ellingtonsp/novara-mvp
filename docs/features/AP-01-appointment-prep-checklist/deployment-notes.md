# AP-01 Deployment Notes — Checklist Feature

## 🛠️ Migration Commands
```bash
# Local (SQLite)
npx knex migrate:latest --env development --knexfile backend/database/knexfile.js

# Staging / Production — use automated script
./scripts/deploy/deploy-staging-backend.sh --migrate --yes
./scripts/deploy/deploy-production.sh --migrate --yes  # requires validation
```
* Scripts auto-run `20250727_add_prep_checklist_column.sql` generated by AP-01.
* Rollback via `knex migrate:down` or `scripts/rollback.js staging`.

## 🚦 Feature Flags
| Flag | Default | Environment Override |
|------|---------|----------------------|
| `checklist_pdf_v1` | `false` | Enable on staging after QA sign-off |
| `checklist_confetti_v2` | `false` | Enable in limited % via PostHog feature gating |

## 🧪 Rollout Plan
1. **Staging QA** — Complete unit + integration tests, manual UX checks.
2. **Dog-fooding** — Internal test users complete first check-in, verify checklist.
3. **0 % Production Dark-Launch** — Behind feature flag off, monitor errors.
4. **5 % Gradual Rollout** — Enable for small cohort, monitor retention uplift.
5. **Full Launch** — Enable for all users; remove rollout flag after ≥60 % interaction KPI achieved.

## 📊 Monitoring
* PostHog funnels: `signup → insight_viewed → checklist_shown → >=1 item_completed`.
* Backend logs: `/api/checklist` error rate < 1 %.
* Alert: High latency (>300 ms p95) on update endpoint.

## 🔄 Revert Strategy
* Toggle feature flags to `false` (instant).
* Rollback migration: data safe to drop column.
* Redeploy previous stable commit via `scripts/rollback.js production`.

## 🎯 Acceptance Criteria for Deploy
- [ ] Migration runs successfully in staging & production.
- [ ] Error rate < 1 % after 24 h dark-launch.
- [ ] KPI: ≥60 % Day-0 interaction in first live cohort.
- [ ] Docs updated (`docs/features/AP-01-appointment-prep-checklist`).

---
> **Last updated:** 2025-07-27 