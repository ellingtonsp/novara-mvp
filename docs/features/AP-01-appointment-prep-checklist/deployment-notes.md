# AP-01 Deployment Notes â€” Checklist Feature

## ðŸ› ï¸ Migration Commands
```bash
# Local (SQLite)
npx knex migrate:latest --env development --knexfile backend/database/knexfile.js

# Staging / Production â€” use automated script
./scripts/deploy/deploy-staging-backend.sh --migrate --yes
./scripts/deploy/deploy-production.sh --migrate --yes  # requires validation
```
* Scripts auto-run `20250727_add_prep_checklist_column.sql` generated by AP-01.
* Rollback via `knex migrate:down` or `scripts/rollback.js staging`.

## ðŸš¦ Feature Flags
| Flag | Default | Environment Override |
|------|---------|----------------------|
| `checklist_pdf_v1` | `false` | Enable on staging after QA sign-off |
| `checklist_confetti_v2` | `false` | Enable in limited % via PostHog feature gating |

## ðŸ§ª Rollout Plan
1. **Staging QA** â€” Complete unit + integration tests, manual UX checks.
2. **Dog-fooding** â€” Internal test users complete first check-in, verify checklist.
3. **0 % Production Dark-Launch** â€” Behind feature flag off, monitor errors.
4. **5 % Gradual Rollout** â€” Enable for small cohort, monitor retention uplift.
5. **Full Launch** â€” Enable for all users; remove rollout flag after â‰¥60 % interaction KPI achieved.

## ðŸ“Š Monitoring
* PostHog funnels: `signup â†’ insight_viewed â†’ checklist_shown â†’ >=1 item_completed`.
* Backend logs: `/api/checklist` error rate < 1 %.
* Alert: High latency (>300 ms p95) on update endpoint.

## ðŸ”„ Revert Strategy
* Toggle feature flags to `false` (instant).
* Rollback migration: data safe to drop column.
* Redeploy previous stable commit via `scripts/rollback.js production`.

## ðŸŽ¯ Acceptance Criteria for Deploy
- [ ] Migration runs successfully in staging & production.
- [ ] Error rate < 1 % after 24 h dark-launch.
- [ ] KPI: â‰¥60 % Day-0 interaction in first live cohort.
- [ ] Docs updated (`docs/features/AP-01-appointment-prep-checklist`).

---
> **Last updated:** 2025-07-27 